---
title: "Survival Compass: Statistical Insights into Lung Cancer Patients' Journey Post-Diagnosis"
author: 
  - Lexi Knight
thanks: "Code and data are available at: https://github.com/LexiKnight/Lung_Cancer/tree/main"
date: today
date-format: long
abstract: "This study investigates the impact of pathogenic stage and treatment modalities on lung cancer survival post-diagnosis. Analysis of patient data reveals significant correlation between pathogenic stage, seeking treatment and survival outcomes. Notably, patients at advanced stages with metastases in distant sites beyond the lung, extensive lymph node involvement and tumors with extensive growth, invading nearby structures demonstrate lower survival rates. These findings underscore the critical importance of early detection, tailored treatment strategies and ongoing research efforts to enhance lung cancer survival rates globally."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

# install packages
# install.packages("knitr")
# install.packages("kableExtra")

# load packages
# library(tidyverse)
# library(knitr)
# library(kableExtra)

```


# Introduction

Clinging to life amidst the shadows of lung cancer, where every breath becomes a battleground. Survival becomes not just a statistic but an interplay between several individual characteristics. We explore the hidden keys to defying the odds and emerging victorious against one of the deadliest adversaries of our time. Lung cancer is the leading cause of cancer-related deaths in the world (Park, 2017). It is a disease that develops in the lining of the airways in lung tissues. Non-small cell lung cancer (NSCLC) is the most common type, accounting for  80-85% of all lung cancers according to the American Cancer society (Markman, 2023). Staging is important for prognosis and making treatment decisions. Common treatments include surgery, radiation therapy and chemotherapy (Kai, 2021). Pathogenic stage is determined by presence of nearby metastasis, lymph node involvement as well as tumor spread and size (Markman, 2023). This paper investigates the relationship between lung cancer patients' survival and pathogenic stage. The estimand is the median survival time in days post-diagnosis. We also look at whether patients decided to have treatment and if so, which method; radiation therapy or chemotherapy. Through analysis of a dataset made up of  981 patients in Sydney, Australia, we offer insight into the prognostic markers. 
 
Tumor size is often the main determinant of stage and treatment. As tumor categories increase, the tumor expands, invading nearby structures (Zhang, 2015). A study involving 52,287 patients diagnosed between the years 1998 and 2003 found tumor size to be an independent prognostic factor in estimating overall survival. The authors found that patients presenting with larger tumors predicted a worse prognosis and thus are associated with a decrease in survival. There is a similar relationship between extensive lymph node involvement and patient survival (Zhang, 2015). Initial spread of cancer cells are localized, then become regional, involving nearby lymph nodes and the most severe cases comprises expansion to other organs such as the brain, liver and bones (Markman, 2023).  A study looked at five year survival rates based on the severity of spread. 62.8% of patients with localized spread, 34.8% of patients with regional and 8% of patients with distant, advanced spread were found to survive for 5 years post diagnosis. More than half of these lung cancer patients have advanced spread to other organs when diagnosed(Markman, 2023). Overall, it is found that patients with no regional lymph node metastases, and smaller tumors are easier to be treated and thus are associated with improved survival rates (Zhang, 2015).

Presence of metastatic LN is one of the most important determinants of prognosis of NSCLC cases (Kai, 2021). In the early stage, cancer has not spread to lymph nodes. As severity increases, lymph node metastasis sequentially spreads to more distant lymph nodes such as mediastinal and there is severe lymph node involvement  (Park, 2017). Lymph node involvement, also termed lymph node ratio, is a crucial factor in guiding treatment options (Kai, 2021). A study made up of 97 patients with a mean age of 63 who have undergone surgery between the years 2009 and 2015 in Korea find that increased lymph node involvement is associated with a more advanced disease status and hence affiliated with prognosis (Park, 2017). Another study looked at 11,341 NSCLC patients between the years 2004 to 2015, from 18 geographically diverse populations, covering approximately 28% of the population of the United States. These patients were treatment naive and underwent surgical resection of the tumor. Although 5757 patients died, the rest showed great results, with a median survival of 22 months (Kai, 2021). The authors found that patients with low lymph node involvement lead to higher survival compared to patients with high lymph node ratios. A regression analysis revealed that lymph node ratio is an independent and significant predictor of patient survival. The authors also observed that disease burden and anatomical location of the lymph nodes involved may influence the patients survival (Kai, 2021). 

After tumor size, LN involvement and presence of distant metastasis are categorized, the pathogenic stage of the cancer is then determined (Eldridge, 2022). The most valuable prognostic factor in non-small cell lung cancer is the pathogenic stage (Park, 2017) .Stage is determined by tumor size, number of tumors  and where the cancer has spread. Stage 1 is localized spread, stage 2 and 3 is regional spread while stage 4 is distant spread of the tumor (Eldridge, 2022). Cancer stage was determined using the seventh American Joint Committee on Cancer staging system (AJCC) (Park, 2017). A study done in Australia including 2119 lung cancer patients illustrated those with stage IV disease, the most advanced stage,  showed shorter survival than those at lower stages (Denton, 2016). The earlier the cancer is found, that is the lower the pathogenic stage, the greater the likelihood curative radiation therapy is an effective treatment (Eldridge, 2022). However, there is minimal literature looking at post-diagnosis survival rates based on pathogenic stage and method of treatment. The extent of this disease illustrates the importance of living a healthy lifestyle, undergoing regular screening and development of improved treatment methods. Over the past decade, there has been great improvement of lymph node assessment in cancer patients (Kai, 2021). Experts hope survival rates continue to improve with  new therapies and treatment approaches  (Markman, 2023). 

The remainder of this paper is structured as follows. In @sec-data, we visualize the exploration of variables constituting the pathogenic stage and treatment types. @sec-model, outlines the model employed to analyze the relationship between these variables and the duration of survival post-diagnosis. Moreover, @sec-results offers visual depictions of the study's outcomes. Finally, in @sec-discussion, we summarize the primary findings, propose avenues for enhancement, and identify potential areas for future research.

# Data {#sec-data}

Our data is 

```{r}
#| label: fig-bills
#| fig-cap: bb
#| echo: false

# install.packages
# install.packages("ggplot2")
# install.packages("dplyr")
# install.packages("showtext")

# load packages
library(ggplot2)
library(dplyr)
library(showtext)

# read in data
analysis_data <- read.csv(file = here::here("data/analysis_data/lung_cancer_analysis_data.csv"))

# Add the desired font (e.g., Patrick Hand)
font_add_google("Patrick Hand", "patrick")

# Set the font for ggplot
showtext_auto()

# Histogram of survival time in days (days_to_death)
ggplot(analysis_data, aes(x = days_to_death)) +
  geom_histogram(binwidth = 50, fill = "forestgreen", color = "black") +
  labs(title = "Distribution of Survival Time in Lung Cancer Patients Post-Diagnosis",
       x = "Survival Time (days)", y = "Frequency") +
  theme_minimal() +
  theme(
    text = element_text(family = "patrick") # Set font to Patrick Hand
  )

# create bar chart for pathogenic_stage
pathogenic_stage_counts <- analysis_data %>%
  group_by(pathogenic_stage) %>%
  summarise(count = n ()) %>%
  mutate(percentage = count / sum(count) * 100) %>%
  arrange(desc(pathogenic_stage))

ggplot(pathogenic_stage_counts, aes(x = pathogenic_stage, y = percentage)) +
  geom_bar(stat = "identity", fill = "lightpink") +
  labs(title = "Percentage of Patients by Pathogenic Stage",
       x = "Pathogenic Stage",
       y = "Percentage") +
  theme_minimal() +
  theme(
    text = element_text(family = "patrick") # Set font to Patrick Hand
  )

# create bar chart for presence_of_distant metastasis 
presence_of_distant_metastasis_counts <- analysis_data %>%
  group_by(presence_of_distant_metastasis) %>%
  summarise(count = n ()) %>%
  mutate(percentage = count / sum(count) * 100) %>%
  arrange(desc(presence_of_distant_metastasis))

ggplot(presence_of_distant_metastasis_counts, aes(x = presence_of_distant_metastasis, y = percentage)) +
  geom_bar(stat = "identity", fill = "gold") +
  labs(title = "Percentage of Patients by Presence of Distant Metastasis",
       x = "Presence of Distant Metastasis",
       y = "Percentage") +
  theme_minimal() +
  theme(
    text = element_text(family = "patrick") # Set font to Patrick Hand
  )

# create bar chart for lymph node involvement 
lymph_node_involvement_counts <- analysis_data %>%
  group_by(lymph_node_involvement) %>%
  summarise(count = n ()) %>%
  mutate(percentage = count / sum(count) * 100) %>%
  arrange(desc(lymph_node_involvement))

ggplot(lymph_node_involvement_counts, aes(x = lymph_node_involvement, y = percentage)) +
  geom_bar(stat = "identity", fill = "cyan") +
  labs(title = "Percentage of Patients by Lymph Node Involvement",
       x = "Lymph Node Involvement",
       y = "Percentage") +
  theme_minimal() +
  theme(
    text = element_text(family = "patrick") # Set font to Patrick Hand
  )

# create bar chart for tumor size
tumor_size_counts <- analysis_data %>%
  group_by(tumor_size) %>%
  summarise(count = n ()) %>%
  mutate(percentage = count / sum(count) * 100) %>%
  arrange(desc(tumor_size))

ggplot(tumor_size_counts, aes(x = tumor_size, y = percentage)) +
  geom_bar(stat = "identity", fill = "purple") +
  labs(title = "Percentage of Patients by Tumor Size",
       x = "Tumor Size",
       y = "Percentage") +
  theme_minimal() +
  theme(
    text = element_text(family = "patrick") # Set font to Patrick Hand
  )

# create bar chart for treatment decision
treatment_decision_counts <- analysis_data %>%
  group_by(treatment_decision) %>%
  summarise(count = n ()) %>%
  mutate(percentage = count / sum(count) * 100) %>%
  arrange(desc(treatment_decision))

ggplot(treatment_decision_counts, aes(x = reorder(treatment_decision, -percentage), y = percentage)) +
  geom_bar(stat = "identity", fill = "blue") +
  geom_text(aes(label = sprintf("%.1f%%", percentage)), hjust = -0.2, color = "black", size = 3) +
  labs(title = "Percentage of Patients by Treatment Decision",
       x = "Treatment Decision",
       y = "Percentage") +
  theme_minimal() +
  coord_flip() +
  theme(
    text = element_text(family = "patrick") # Set font to Patrick Hand
  )

# Create bar chart for treatment type
treatment_type_counts <- analysis_data %>%
  group_by(treatment_type) %>%
  summarise(count = n ()) %>%
  mutate(percentage = count / sum(count) * 100) %>%
  arrange(desc(treatment_type))

ggplot(treatment_type_counts, aes(x = reorder(treatment_type, -percentage), y = percentage)) +
  geom_bar(stat = "identity", fill = "orange") +
  geom_text(aes(label = sprintf("%.1f%%", percentage)), hjust = -0.2, color = "black", size = 3) +
  geom_text(data = treatment_type_counts, aes(label = treatment_type), hjust = 1.2, color = "black", size = 3) +
  labs(title = "Percentage of Patients by Treatment Type",
       x = "Treatment Type",
       y = "Percentage") +
  theme_minimal() +
  coord_flip() +
  scale_x_discrete(breaks = seq(0, max(treatment_type_counts$percentage), by = 5)) +
  theme(
    text = element_text(family = "patrick") # Set font to Patrick Hand
  )


```

Talk more about it.



```{r}
#| label: fig-planes
#| fig-cap: Relationship between wing length and width
#| echo: false
#| warning: false
#| message: false

```

Talk way more about it. 



# Model {#sec-model}

The goal of our modeling strategy is twofold. Firstly, we aim to investigate the post-diagnosis survival outcomes of lung cancer patients, considering the pathogenic stage. Secondly, we seek to assess the efficacy of two common treatment modalities, radiation therapy and chemotherapy, in improving survival chances across different pathogenic stages.

Here, we briefly describe the Bayesian analysis model used to investigate survival outcomes in lung cancer patients based on pathogenic stage and treatment modality. Detailed background information and diagnostic assessments are provided in the [Appendix -@].

Our Bayesian analysis model is tailored to capture the complex relationships between pathogenic stage, treatment modality, and post-diagnosis survival outcomes in lung cancer patients. The model accounts for the multifaceted nature of cancer progression, incorporating tumor size, metastatic spread, and lymph node involvement to characterize pathogenic stage.

## Model set-up

Define $y_i$ as the number of seconds that the plane remained aloft. Then $\beta_i$ is the wing width and $\gamma_i$ is the wing length, both measured in millimeters.  

\begin{align} 
y_i|\mu_i, \sigma &\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &= \alpha + \beta_i + \gamma_i\\
\alpha &\sim \mbox{Normal}(0, 2.5) \\
\beta &\sim \mbox{Normal}(0, 2.5) \\
\gamma &\sim \mbox{Normal}(0, 2.5) \\
\sigma &\sim \mbox{Exponential}(1)
\end{align}

We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.


### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.

The Bayesian analysis model serves as a powerful tool for investigating post-diagnosis survival outcomes in lung cancer patients. By incorporating pathogenic stage information and treatment modalities into the analysis, we aim to elucidate the factors influencing patient prognosis and provide insights to guide personalized treatment decisions.


# Results {#sec-results}

Our results are summarized in @.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Load required libraries
library(ggplot2)



# Scatter plot survival time vs. pathogenic stage - to compare survival probabilities
ggplot(analysis_data, aes(x = pathogenic_stage, y = days_to_death)) +
  geom_point(size = 3, color = "lightpink") +
  geom_smooth(method = "lm", se = FALSE, color = "red") +  
  # Add a linear trend line
  labs(title = "Survival Time vs. Pathogenic Stage Post-Diagnosis",
       x = "Pathogenic Stage",
       y = "Survival Time (days)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  # Rotate x-axis labels for better readability
  theme(text = element_text(family = "patrick") 
  # Set font to Patrick Hand
  )

# Plotting
ggplot(analysis_data, aes(x = pathogenic_stage, y = days_to_death)) +
  geom_boxplot(fill = "lightblue") +
  labs(title = "Days to Death Distribution by Pathogenic Stage for Lung Cancer Patients",
       x = "Pathogenic Stage",
       y = "Days to Death") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels for better readability


# Scatter plot survival time vs. Presence of Distant Metastasis
ggplot(analysis_data, aes(x = presence_of_distant_metastasis, y = days_to_death)) +
  geom_point(size = 3, color = "gold") +
  geom_smooth(method = "lm", se = FALSE, color = "red") +  
  # Add a linear trend line
  labs(title = "Survival Time vs. Presence of Distant Metastasis Post-Diagnosis",
       x = "Presence of Distant Metastasis",
       y = "Survival Time (days)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  # Rotate x-axis labels for better readability
  theme(text = element_text(family = "patrick") 
  # Set font to Patrick Hand
  )

# Scatter plot survival time vs. Lymph node involvement
ggplot(analysis_data, aes(x = lymph_node_involvement, y = days_to_death)) +
  geom_point(size = 3, color = "cyan") +
  geom_smooth(method = "lm", se = FALSE, color = "red") +  
  # Add a linear trend line
  labs(title = "Survival Time vs. Lymph Node Involvement Post-Diagnosis",
       x = "Lymph Node Involvement",
       y = "Survival Time (days)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  # Rotate x-axis labels for better readability
  theme(text = element_text(family = "patrick") 
  # Set font to Patrick Hand
  )

# Scatter plot survival time vs. Tumor Size
ggplot(analysis_data, aes(x = tumor_size, y = days_to_death)) +
  geom_point(size = 3, color = "purple") +
  geom_smooth(method = "lm", se = FALSE, color = "red") +  
  # Add a linear trend line
  labs(title = "Survival Time vs. Tumor Size Post-Diagnosis",
       x = "Tumor Size",
       y = "Survival Time (days)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  # Rotate x-axis labels for better readability
  theme(text = element_text(family = "patrick") 
  # Set font to Patrick Hand
  )

# Scatter plot survival time vs. Treatment Decision
ggplot(analysis_data, aes(x = treatment_decision, y = days_to_death)) +
  geom_point(size = 3, color = "blue") +
  geom_smooth(method = "lm", se = FALSE, color = "red") +  
  # Add a linear trend line
  labs(title = "Survival Time vs. Treatment Decision Post-Diagnosis",
       x = "Treatment Decision",
       y = "Survival Time (days)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  # Rotate x-axis labels for better readability
  theme(text = element_text(family = "patrick") 
  # Set font to Patrick Hand
  )

# Scatter plot survival time vs. Treatment Type
ggplot(analysis_data, aes(x = treatment_type, y = days_to_death)) +
  geom_point(size = 3, color = "cyan") +
  geom_smooth(method = "lm", se = FALSE, color = "red") +  
  # Add a linear trend line
  labs(title = "Survival Time vs. Treatment Type Post-Diagnosis",
       x = "Treatment Type",
       y = "Survival Time (days)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  # Rotate x-axis labels for better readability
  theme(text = element_text(family = "patrick") 
  # Set font to Patrick Hand
  )

```

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false

```



# Discussion {#sec-discussion}

## First discussion point {#sec-first-point}

## Second discussion point

## Third discussion point

## Weaknesses and next steps



\newpage

\appendix

# Appendix {#sec-appendix}


# Additional data details

# Model details {#sec-model-details}
we compare the posterior with the prior. This shows... 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]


```

## Diagnostics
Is this needed?

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2


```



\newpage


# References


